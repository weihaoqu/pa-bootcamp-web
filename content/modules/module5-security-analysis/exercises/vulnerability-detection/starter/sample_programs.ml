(** Sample programs for vulnerability detection testing (provided). *)

open Shared_ast.Ast_types

(** SQL injection: get_param → exec_query without sanitization. *)
let sql_injection : program =
  [{ name = "handle_search"; params = [];
     body = [
       Assign ("input", Call ("get_param", [IntLit 0]));
       Assign ("query", BinOp (Add, Var "input", IntLit 0));
       Assign ("_r", Call ("exec_query", [Var "query"]));
     ] }]

(** XSS: get_param → send_response without encoding. *)
let xss_reflected : program =
  [{ name = "show_name"; params = [];
     body = [
       Assign ("name", Call ("get_param", [IntLit 0]));
       Assign ("html", BinOp (Add, Var "name", IntLit 0));
       Assign ("_r", Call ("send_response", [Var "html"]));
     ] }]

(** Command injection: get_param → exec_cmd. *)
let command_injection : program =
  [{ name = "run_tool"; params = [];
     body = [
       Assign ("file", Call ("get_param", [IntLit 0]));
       Assign ("cmd", BinOp (Add, Var "file", IntLit 0));
       Assign ("_r", Call ("exec_cmd", [Var "cmd"]));
     ] }]

(** Path traversal: get_param → open_file. *)
let path_traversal : program =
  [{ name = "read_page"; params = [];
     body = [
       Assign ("path", Call ("get_param", [IntLit 0]));
       Assign ("_r", Call ("open_file", [Var "path"]));
     ] }]

(** Safe SQL: input sanitized before exec_query. *)
let safe_sql : program =
  [{ name = "safe_search"; params = [];
     body = [
       Assign ("input", Call ("get_param", [IntLit 0]));
       Assign ("safe", Call ("escape_sql", [Var "input"]));
       Assign ("query", BinOp (Add, Var "safe", IntLit 0));
       Assign ("_r", Call ("exec_query", [Var "query"]));
     ] }]

(** Safe program with no user input at all. *)
let safe_no_input : program =
  [{ name = "compute"; params = [];
     body = [
       Assign ("x", IntLit 42);
       Assign ("y", BinOp (Add, Var "x", IntLit 1));
     ] }]

(** Multiple vulnerabilities in one program (two functions). *)
let multi_vuln : program =
  [{ name = "handler1"; params = [];
     body = [
       Assign ("input", Call ("get_param", [IntLit 0]));
       Assign ("_r", Call ("exec_query", [Var "input"]));
     ] };
   { name = "handler2"; params = [];
     body = [
       Assign ("name", Call ("get_param", [IntLit 0]));
       Assign ("_r", Call ("send_response", [Var "name"]));
     ] }]
